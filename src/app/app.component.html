<h1>HAR Parser</h1>
<section class="filter-section">
  <div>
    <input
      type="file"
      id="fileInput"
      #inputFile
      accept=".har"
      (change)="onFileSelection($event)"
    />
  </div>
  <div class="filter-section no-mar">
    <div>
      <mat-button-toggle-group
        [formControl]="categoryControl"
        aria-label="Filter by category"
      >
        <mat-button-toggle value="all">All</mat-button-toggle>
        <mat-button-toggle value="fetch">Fetch/XHR</mat-button-toggle>
        <mat-button-toggle value="stylesheet">CSS</mat-button-toggle>
        <mat-button-toggle value="script">JS</mat-button-toggle>
        <mat-button-toggle value="font">Font</mat-button-toggle>
        <mat-button-toggle value="document">Doc</mat-button-toggle>
        <mat-button-toggle value="image">Img</mat-button-toggle>
        <mat-button-toggle value="media">Media</mat-button-toggle>
        <mat-button-toggle value="websocket">WS</mat-button-toggle>
        <mat-button-toggle value="other">Other</mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    <div class="d-flex gap-20">
      <mat-checkbox class="example-margin" [(ngModel)]="responseData"
        >View Data</mat-checkbox
      >
      <mat-checkbox
        class="example-margin"
        (change)="toggleShow()"
        [(ngModel)]="showDetails"
        >Expand All</mat-checkbox
      >
    </div>
    <div>
      <div>Count: {{ this.items().length }}</div>
    </div>
  </div>
</section>
<section class="filter-section">
  <multi-filter
    class="full"
    [keys]="keys"
    [globalSearch]="false"
    [globalSearchMultiple]="false"
    [source]="[]"
    [conditions]="[]"
    [outputType]="'object'"
  >
  </multi-filter>
</section>
<div class="wrapper">
  <mat-accordion multi>
    @for (item of items(); track $index) {
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title class="header">
            <div class="head-grp">
              <div
                class="status {{ getCodeBasedColor(item?.response?.status) }}"
                [title]="item?.response?.status"
              >
                {{ item?.response?.status }}
              </div>
              <div class="method" [title]="item?.request?.method">
                {{ item?.request?.method }}
              </div>
              <div class="url" [title]="item?.request?.url">
                {{ item?.request?.url }}
              </div>
            </div></mat-panel-title
          >
          <mat-panel-description class="head-grp">
            <div class="time" [title]="item?.time">
              {{ getTime(item?.time) }}
            </div>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div class="sub-header">
          <div class="req-head">
            <h4>Request</h4>
            <h5>Headers</h5>
            <div class="sub-item">
              @for (
                req of item?.request?.headers;
                track req.name + "" + $index
              ) {
                <div class="name" [title]="req.name">{{ req.name }}</div>
                <div class="val" [title]="req.value">{{ req.value }}</div>
              }
            </div>
            @if (
              responseData &&
              item._resourceType === "fetch" &&
              item?.request?.postData?.text
            ) {
              <h5>Data</h5>
              <div>
                <pre>{{ jsonParse(item?.request?.postData?.text) | json }}</pre>
              </div>
            }
          </div>
          <div class="res-head">
            <h4>Response</h4>
            <h5>Headers</h5>
            <div class="sub-item">
              @for (
                req of item?.response?.headers;
                track req.name + "" + $index
              ) {
                <div class="name" [title]="req.name">{{ req.name }}</div>
                <div class="val" [title]="req.value">{{ req.value }}</div>
              }
            </div>
            @if (responseData && item._resourceType === "fetch") {
              <h5>Data</h5>
              @if (
                getContentType(item.response.headers, "Content-Type") ===
                "application/json"
              ) {
                <div>
                  <pre class="data-box">{{
                    jsonParse(item?.response?.content?.text) | json
                  }}</pre>
                </div>
              } @else {
                <div>
                  <pre class="data-box">{{
                    item?.response?.content?.text
                  }}</pre>
                </div>
              }
            } @else if (responseData && item._resourceType !== "fetch") {
              <h5>Data</h5>
              <p>
                <a (click)="showData(item?.response?.content?.text)"
                  >View Data</a
                >
              </p>
            }
          </div>
        </div>
      </mat-expansion-panel>
    }
  </mat-accordion>
</div>
